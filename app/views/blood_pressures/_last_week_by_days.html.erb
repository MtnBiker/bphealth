<!-- Variable for use below -->
<%# last_record = BloodPressure.order('statdate asc').last.statdate %><br>  <!-- 2022-01-06 16:14:48 UTC -->
<% last_record = BloodPressure.order('statdate asc').last.statdate %><br> <!-- last_record: 2021-12-26 04:40:23 UTC, but in db as 2021-12-25 20:40:23-08, Although ended up with last not being the most current if since sorting by id. How was an id reused? -->
3. last_record.localtime.formatted_offset: <%= last_record.localtime.formatted_offset(false) %><br>
4. Midnight     :  <%= last_record.beginning_of_day %><br>
<% timeZone = last_record.localtime.formatted_offset(false).slice!(0, 3).to_i %><br> <!-- Correct, but not using it, see next line -->
5. Midnight UTC?: <%= midnight = last_record.beginning_of_day - timeZone.hour %><br>
6. timeZone.hour: <%= timeZone.hour %> converts to seconds<br><%= timeZone.hour.class %><br>
6.1 <%=  last_record  %><br>
7. last_record + timeZone.hour : <%= last_record + timeZone.hour %><br>

<% timeZoneNeg = -last_record.localtime.formatted_offset(false).slice!(0, 3).to_i %> <!-- Just because I'm substracting it and it may be easier to use a positive number or not. Don't need to, but had problems at beginning so left it, but could change sign and variable<br> -->
<%# last_record_minus_zone = last_record - timeZone %>
<!-- xmin: "2021-01-01", xmax: "2022-01-01" How do you tell Rails 3am to 12 pm or similar-->

<!-- Stack 7 daily records, then maybe put on one graph when I figure it out -->
<!-- :stattime is a symbol and comes through as GMT, so can't use .localtime to get the time showing right -->
<!-- The order of the variables and methods in the following matters -->

<hr><% last_record+timeZoneNeg.hour %> <hr><!-- 2022-01-06 16:14:48 -0800, So still essentially UTC -->
<!-- <hr><%#= last_record+(timeZoneNeg.hour) %> <hr> 2022-01-06 16:14:48 -0800 -->
<%#= (last_record+timeZoneNeg).hour %> <!-- 8 -->
<!-- I'm looking for midnight of the day, so for the abscissa, but finding stattime might be a different story. The data is selected correctly, but the abscissa labeling is wrong. The abscissa is in UTC and not local time -->
<hr><% last_record-8.hour %><hr>  <!-- :: 2022-01-06 00:14:48 -0800 -->
<% last_record+8.hour %><hr>  <!-- :2022-01-06 16:14:48 -0800  -->

<div class="text-center font-weight-bold">
  <%= line_chart BpTimeWithZone.where(statdate: last_record+timeZoneNeg.hour-1.day..last_record).pluck(:stattime, :systolic), title: "Last week by days (Most recent at top). Up to #{last_record.strftime("%c")}. The x-axis is GMT", ytitle: "Systolic", min: 100, max: 200, color: "#D9A1FF" %>
<!-- Both (above and below) are showing the same graph. -->
    <%= line_chart BpTimeWithZone.where(statdate: midnight..last_record).pluck(:stattime, :systolic), title: "Last week by days (Most recent at top). Up to #{last_record.strftime("%c")}. The x-axis is GMT", ytitle: "Systolic", min: 100, max: 200, color: "#D9A1FF" %>

  <hr><%= last_record_1_day_ago = last_record+timeZoneNeg.hour-1.day %> <% last_record_1_day_ago %>
  <%= line_chart BpTimeWithZone.where(statdate: last_record+timeZoneNeg.hour-2.day..last_record+timeZoneNeg-1.day).pluck(:stattime, :systolic), title: "#{last_record_1_day_ago.strftime("%c")}", ytitle: "Systolic", min: 100, max: 200, color: "#D9A1FF" %>
    <%#= line_chart BpTimeWithZone.where(statdate: last_record+timeZoneNeg.hour-2.day..last_record+timeZoneNeg-1.day).pluck(:stattime, :systolic), ytitle: "Systolic", min: 100, max: 200, color: "#D9A1FF", title: "Last week by days (Most recent at top). Up to #{last_record+timeZoneNeg.hour-2.day.strftime("%c")} %> <!-- Does not work -->

  <hr><%= last_record_2_day_ago = last_record+timeZoneNeg.hour-2.day %> <% last_record_2_day_ago %>
  <%= line_chart BpTimeWithZone.where(statdate: last_record+timeZoneNeg.hour-3.day..last_record+timeZoneNeg-2.day).pluck(:stattime, :systolic), title: "#{last_record_2_day_ago.strftime("%c")}", ytitle: "Systolic", min: 100, max: 200, color: "#D9A1FF" %>

  <hr><%=  last_record_3_day_ago = last_record+timeZoneNeg.hour-3.day %> <% last_record_3_day_ago %>
  <%= line_chart BpTimeWithZone.where(statdate: last_record+timeZoneNeg.hour-4.day..last_record+timeZoneNeg-3.day).pluck(:stattime, :systolic), ytitle: "Systolic", min: 100, max: 200, color: "#D9A1FF" %>

  <hr><%= last_record_4_day_ago = last_record+timeZoneNeg.hour-4.day %> <% last_record_4_day_ago %>
  <%= line_chart BpTimeWithZone.where(statdate: last_record+timeZoneNeg.hour-5.day..last_record+timeZoneNeg-4.day).pluck(:stattime, :systolic), ytitle: "Systolic", min: 100, max: 200, color: "#D9A1FF" %>

  <hr><%= last_record_5_day_ago = last_record+timeZoneNeg.hour-5.day %> <% last_record_5_day_ago %>
  <%= line_chart BpTimeWithZone.where(statdate: last_record+timeZoneNeg.hour-6.day..last_record+timeZoneNeg-5.day).pluck(:stattime, :systolic), ytitle: "Systolic", min: 100, max: 200, color: "#D9A1FF" %>

  <hr><%= last_record_6_day_ago = last_record+timeZoneNeg.hour-6.day %> <% last_record_6_day_ago %>
  <%= line_chart BpTimeWithZone.where(statdate: last_record+timeZoneNeg.hour-7.day..last_record+timeZoneNeg-6.day).pluck(:stattime, :systolic), ytitle: "Systolic", min: 100, max: 200, color: "#D9A1FF" %>
</div>
<hr>
<%= date = Date.today %>
<hr>

<%= date.to_time.in_time_zone('America/New_York').beginning_of_day %>
# Currently outputs => 2011-11-02 00:00:00 -0400
<hr>
<%= Time.now.in_time_zone('Asia/Shanghai').beginning_of_day %>
# Currently outputs => 2011-11-03 00:00:00 +0800
<hr>
# date = Date.today
<hr>
<%= date.to_time.in_time_zone('Asia/Shanghai').beginning_of_day %>
# Currently outputs => 2011-11-02 00:00:00 +0800